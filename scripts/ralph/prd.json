{
  "version": "2.3",
  "project": "OpenAI API Integration for LinkedIn Post Generation",
  "branchName": "ralph/openai-linkedin-post-generation",
  "description": "Enable users to use their OpenAI API keys as an alternative to Claude for generating LinkedIn posts based on GitHub repository analysis",
  "createdAt": "2026-01-13T00:00:00.000Z",
  "techStack": {
    "backend": "Python/FastAPI with Pydantic",
    "database": "In-memory session storage with AES-256-GCM encryption",
    "frontend": "React 19 with TypeScript and Zustand",
    "testing": "Jest + React Testing Library (frontend), pytest (backend)"
  },
  "functionalRequirements": [
    {
      "id": "FR-001",
      "title": "OpenAI API Key Input",
      "description": "Provide a secure form for users to enter their OpenAI API key with proper validation",
      "priority": "must",
      "acceptanceCriteria": [
        "GIVEN a user on the app WHEN they view the AI provider section THEN they see an option to connect OpenAI",
        "GIVEN an OpenAI input form WHEN user enters a key starting with 'sk-' THEN the form accepts the input",
        "GIVEN an invalid key format WHEN user submits THEN a validation error is displayed"
      ]
    },
    {
      "id": "FR-002",
      "title": "OpenAI Key Validation",
      "description": "Validate the API key by making a lightweight API call to OpenAI's models.list endpoint",
      "priority": "must",
      "acceptanceCriteria": [
        "GIVEN a valid OpenAI API key WHEN submitted THEN the system confirms connection success",
        "GIVEN an invalid OpenAI API key WHEN submitted THEN the system returns an authentication error",
        "GIVEN validation in progress WHEN waiting THEN a loading indicator is displayed"
      ]
    },
    {
      "id": "FR-003",
      "title": "OpenAI Key Storage",
      "description": "Store the validated API key encrypted with AES-256-GCM in the session-based storage service",
      "priority": "must",
      "acceptanceCriteria": [
        "GIVEN a validated OpenAI key WHEN stored THEN it is encrypted using AES-256-GCM",
        "GIVEN a stored key WHEN retrieved THEN it is decrypted correctly for API calls",
        "GIVEN a session ID WHEN storing THEN the key is isolated to that session only"
      ]
    },
    {
      "id": "FR-004",
      "title": "OpenAI Connection Status",
      "description": "Display the current connection status with a masked version of the API key",
      "priority": "must",
      "acceptanceCriteria": [
        "GIVEN a connected OpenAI key WHEN viewing status THEN user sees 'Connected' with masked key (e.g., 'sk-...abcd')",
        "GIVEN no OpenAI key connected WHEN viewing status THEN user sees 'Not Connected' state",
        "GIVEN a connection error WHEN viewing status THEN user sees the error message"
      ]
    },
    {
      "id": "FR-005",
      "title": "OpenAI Disconnect",
      "description": "Allow users to remove their stored OpenAI API key from the session",
      "priority": "must",
      "acceptanceCriteria": [
        "GIVEN a connected OpenAI key WHEN user clicks disconnect THEN a confirmation dialog appears",
        "GIVEN confirmation accepted WHEN disconnecting THEN the key is removed from storage",
        "GIVEN successful disconnect WHEN viewing status THEN status shows 'Not Connected'"
      ]
    },
    {
      "id": "FR-006",
      "title": "OpenAI Post Generation",
      "description": "Generate LinkedIn posts using OpenAI GPT models with the same 3 style options",
      "priority": "must",
      "acceptanceCriteria": [
        "GIVEN a connected OpenAI key and analysis WHEN user generates a post THEN OpenAI API is called",
        "GIVEN a generation request WHEN successful THEN the generated post content is returned",
        "GIVEN the three post styles WHEN generating with OpenAI THEN all styles work correctly"
      ]
    },
    {
      "id": "FR-007",
      "title": "Provider Selection",
      "description": "Allow users to choose between Claude and OpenAI when both providers are connected",
      "priority": "must",
      "acceptanceCriteria": [
        "GIVEN both providers connected WHEN viewing generation UI THEN a provider selector is shown",
        "GIVEN provider selector WHEN user selects OpenAI THEN subsequent generation uses OpenAI",
        "GIVEN only one provider connected WHEN viewing UI THEN that provider is auto-selected"
      ]
    },
    {
      "id": "FR-008",
      "title": "OpenAI Error Handling",
      "description": "Handle OpenAI-specific errors including rate limits, quota exceeded, and invalid keys",
      "priority": "must",
      "acceptanceCriteria": [
        "GIVEN a rate limit error (429) WHEN generating THEN user sees retry countdown with Retry-After",
        "GIVEN a quota exceeded error WHEN generating THEN user sees billing-related error message",
        "GIVEN an invalid key error WHEN generating THEN user sees authentication error with guidance"
      ]
    },
    {
      "id": "FR-009",
      "title": "Model Selection",
      "description": "Allow users to select which GPT model to use for generation",
      "priority": "should",
      "acceptanceCriteria": [
        "GIVEN OpenAI connected WHEN viewing generation UI THEN user can select from gpt-4o, gpt-4, gpt-3.5-turbo",
        "GIVEN no model selected WHEN generating THEN gpt-4o is used as default",
        "GIVEN a model selected WHEN generating THEN that specific model is used"
      ]
    },
    {
      "id": "FR-010",
      "title": "Remember Provider Preference",
      "description": "Remember the user's last used provider selection within the session",
      "priority": "should",
      "acceptanceCriteria": [
        "GIVEN a provider selected WHEN user generates THEN that selection is remembered",
        "GIVEN a remembered provider WHEN returning to generation THEN previous selection is pre-selected"
      ]
    }
  ],
  "nonFunctionalRequirements": [
    {
      "id": "NFR-001",
      "title": "API Key Encryption",
      "priority": "must",
      "acceptanceCriteria": [
        "OpenAI API keys are encrypted using AES-256-GCM before storage",
        "Encryption follows the same pattern as existing Claude key storage"
      ]
    },
    {
      "id": "NFR-002",
      "title": "Session Isolation",
      "priority": "must",
      "acceptanceCriteria": [
        "Each user session has isolated key storage via X-Session-ID header",
        "One session cannot access another session's stored keys"
      ]
    },
    {
      "id": "NFR-003",
      "title": "No Key Logging",
      "priority": "must",
      "acceptanceCriteria": [
        "API keys never appear in application logs",
        "Keys matching 'sk-' pattern are filtered from all log outputs"
      ]
    },
    {
      "id": "NFR-004",
      "title": "Input Validation",
      "priority": "must",
      "acceptanceCriteria": [
        "All API inputs validated with Pydantic schemas on backend",
        "All form inputs validated with Zod schemas on frontend"
      ]
    },
    {
      "id": "NFR-005",
      "title": "Key Validation Response Time",
      "priority": "should",
      "acceptanceCriteria": [
        "OpenAI key validation completes within 5 seconds under normal conditions"
      ]
    },
    {
      "id": "NFR-006",
      "title": "Generation Response Time",
      "priority": "should",
      "acceptanceCriteria": [
        "Post generation completes within 60 seconds under normal conditions"
      ]
    },
    {
      "id": "NFR-007",
      "title": "TypeScript Strict Mode",
      "priority": "must",
      "acceptanceCriteria": [
        "All TypeScript code passes strict mode compilation",
        "npm run typecheck passes without errors"
      ]
    },
    {
      "id": "NFR-008",
      "title": "Test Coverage",
      "priority": "should",
      "acceptanceCriteria": [
        "New backend services have pytest unit tests",
        "New frontend components have Jest/RTL tests"
      ]
    },
    {
      "id": "NFR-SEC-001",
      "title": "Rate Limiting",
      "priority": "must",
      "acceptanceCriteria": [
        "Auth endpoints limited to 100 requests/minute per session",
        "Generation endpoints limited to 20 requests/minute per session",
        "Rate limit responses include Retry-After header"
      ]
    },
    {
      "id": "NFR-SEC-002",
      "title": "Security Headers",
      "priority": "must",
      "acceptanceCriteria": [
        "All responses include CSP, X-Content-Type-Options, X-Frame-Options, HSTS headers",
        "Pass securityheaders.com basic scan"
      ]
    },
    {
      "id": "NFR-SEC-003",
      "title": "Session Security",
      "priority": "must",
      "acceptanceCriteria": [
        "Session IDs generated with 256-bit CSPRNG entropy",
        "Sessions expire after 24 hours of inactivity",
        "Expired sessions have keys securely deleted"
      ]
    },
    {
      "id": "NFR-SEC-004",
      "title": "Audit Logging",
      "priority": "should",
      "acceptanceCriteria": [
        "All key operations logged with timestamp, session_id, operation, status",
        "Unauthorized access attempts logged with full request context",
        "No API keys appear in any log output"
      ]
    }
  ],
  "securityAnalysis": {
    "applicableRegulations": [
      "OWASP Top 10 2021",
      "OWASP API Security Top 10",
      "PDPA (Singapore) - Limited scope",
      "OpenAI Terms of Service"
    ],
    "complianceScope": {
      "pdpa": {
        "applicable": true,
        "scope": "Limited - Session IDs may correlate to user behavior; API key handling involves user credentials",
        "requirements": [
          "Data minimization",
          "Secure storage",
          "User consent for cross-border transfer"
        ]
      },
      "masTrm": {
        "applicable": false,
        "reason": "Not a financial institution"
      },
      "im8": {
        "applicable": false,
        "reason": "Not a government/public sector project"
      },
      "csaCybersecurityAct": {
        "applicable": false,
        "reason": "Not critical infrastructure"
      },
      "crossBorderTransfer": {
        "applicable": true,
        "reason": "API keys transmitted to OpenAI US servers for validation",
        "mitigations": [
          "User-provided keys (user consents to OpenAI TOS)",
          "TLS encryption in transit",
          "AES-256-GCM at rest",
          "Session-scoped only"
        ]
      }
    },
    "dataClassification": [
      {
        "dataType": "OpenAI API Key",
        "classification": "SECRET",
        "encryption": "TLS 1.3 (transit) + AES-256-GCM (rest)",
        "accessLevel": "Session owner only",
        "retention": "Session lifetime (cleared on disconnect or session end)",
        "handling": "Never log, mask display, secure input"
      },
      {
        "dataType": "Claude API Key",
        "classification": "SECRET",
        "encryption": "TLS 1.3 (transit) + AES-256-GCM (rest)",
        "accessLevel": "Session owner only",
        "retention": "Session lifetime",
        "handling": "Never log, mask display, secure input"
      },
      {
        "dataType": "Session ID",
        "classification": "Internal",
        "encryption": "TLS 1.3 (transit)",
        "accessLevel": "Per-client",
        "retention": "Session lifetime",
        "handling": "Cryptographically random generation"
      },
      {
        "dataType": "GitHub Repository URL",
        "classification": "Public",
        "encryption": "TLS 1.3 (transit)",
        "accessLevel": "Session owner",
        "retention": "Request-scoped",
        "handling": "Validate URL format"
      },
      {
        "dataType": "Generated LinkedIn Post",
        "classification": "Internal",
        "encryption": "TLS 1.3 (transit)",
        "accessLevel": "Session owner",
        "retention": "Request-scoped",
        "handling": "User-controlled content"
      },
      {
        "dataType": "Error Messages",
        "classification": "Internal",
        "encryption": "TLS 1.3 (transit)",
        "accessLevel": "Session owner",
        "retention": "Request-scoped",
        "handling": "Sanitize - no key exposure"
      }
    ],
    "threatModel": [
      {
        "category": "Spoofing",
        "threat": "Session ID impersonation",
        "asset": "User session, stored API keys",
        "likelihood": "M",
        "impact": "H",
        "mitigation": "Cryptographically random 256-bit session IDs; Session ID validation",
        "priority": "P0"
      },
      {
        "category": "Spoofing",
        "threat": "API key theft via MITM",
        "asset": "OpenAI/Claude API keys",
        "likelihood": "L",
        "impact": "H",
        "mitigation": "TLS 1.3 enforcement; HSTS headers",
        "priority": "P0"
      },
      {
        "category": "Spoofing",
        "threat": "Cross-site request forgery (CSRF)",
        "asset": "User actions, API key operations",
        "likelihood": "M",
        "impact": "M",
        "mitigation": "CSRF tokens on state-changing operations; SameSite cookies",
        "priority": "P1"
      },
      {
        "category": "Tampering",
        "threat": "Malicious prompt injection",
        "asset": "Generated content quality",
        "likelihood": "M",
        "impact": "M",
        "mitigation": "Prompt template hardening; Output sanitization",
        "priority": "P1"
      },
      {
        "category": "Repudiation",
        "threat": "Unauthorized API key usage denied",
        "asset": "Audit trail, user accountability",
        "likelihood": "M",
        "impact": "M",
        "mitigation": "Comprehensive audit logging with timestamps and session IDs",
        "priority": "P1"
      },
      {
        "category": "Information Disclosure",
        "threat": "API Key Exposure via Logs",
        "asset": "OpenAI/Claude API Key",
        "likelihood": "H",
        "impact": "H",
        "mitigation": "Pattern-based log filtering (sk-*, sk-ant-*); Log sanitization",
        "priority": "P0"
      },
      {
        "category": "Information Disclosure",
        "threat": "API Key Exposure in Error Responses",
        "asset": "API keys",
        "likelihood": "M",
        "impact": "H",
        "mitigation": "Generic error messages; No key reflection in errors",
        "priority": "P0"
      },
      {
        "category": "Information Disclosure",
        "threat": "API Key Exposure in Frontend",
        "asset": "OpenAI API Key",
        "likelihood": "M",
        "impact": "H",
        "mitigation": "Store only masked key (last 4 chars) in frontend state",
        "priority": "P0"
      },
      {
        "category": "Denial of Service",
        "threat": "API rate limit exhaustion",
        "asset": "Service availability",
        "likelihood": "M",
        "impact": "M",
        "mitigation": "Backend rate limiting; User-level quotas",
        "priority": "P1"
      },
      {
        "category": "Denial of Service",
        "threat": "Session storage exhaustion",
        "asset": "In-memory storage",
        "likelihood": "L",
        "impact": "M",
        "mitigation": "Session limits; TTL-based cleanup",
        "priority": "P2"
      },
      {
        "category": "Elevation of Privilege",
        "threat": "Cross-session key access",
        "asset": "Other users' API keys",
        "likelihood": "L",
        "impact": "H",
        "mitigation": "Session isolation; Authorization checks on all key operations",
        "priority": "P0"
      },
      {
        "category": "Elevation of Privilege",
        "threat": "Backend injection via API key input",
        "asset": "Backend server",
        "likelihood": "L",
        "impact": "H",
        "mitigation": "Strict input validation; No shell/SQL operations with keys",
        "priority": "P0"
      }
    ],
    "securityRequirements": [
      {
        "id": "SEC-001",
        "requirement": "Encrypt API keys at rest using AES-256-GCM",
        "regulation": "OWASP A02",
        "priority": "P0",
        "acceptanceCriteria": "GIVEN an API key is stored WHEN retrieved from memory THEN it must be encrypted with AES-256-GCM using a per-session derived key"
      },
      {
        "id": "SEC-002",
        "requirement": "Never log API keys or key fragments",
        "regulation": "OWASP A09",
        "priority": "P0",
        "acceptanceCriteria": "GIVEN any log statement WHEN the output contains patterns matching sk-* or sk-ant-* THEN the pattern is replaced with [REDACTED]"
      },
      {
        "id": "SEC-003",
        "requirement": "Validate all API key inputs with schemas",
        "regulation": "OWASP A03",
        "priority": "P0",
        "acceptanceCriteria": "GIVEN an API key input WHEN submitted THEN Pydantic validates format (OpenAI: sk-*, length 40-200 chars)"
      },
      {
        "id": "SEC-004",
        "requirement": "Session-based access control for keys",
        "regulation": "OWASP A01",
        "priority": "P0",
        "acceptanceCriteria": "GIVEN a key retrieval request WHEN session ID doesn't match THEN return 403 Forbidden"
      },
      {
        "id": "SEC-005",
        "requirement": "Mask API keys in frontend display",
        "regulation": "OWASP A02",
        "priority": "P0",
        "acceptanceCriteria": "GIVEN a connected key WHEN displaying status THEN only show sk-...{last 4 chars} format"
      },
      {
        "id": "SEC-006",
        "requirement": "TLS 1.3 for all external communications",
        "regulation": "OWASP A02",
        "priority": "P0",
        "acceptanceCriteria": "GIVEN an API request WHEN connecting to OpenAI/Claude/GitHub THEN TLS 1.3 minimum is enforced"
      },
      {
        "id": "SEC-007",
        "requirement": "Secure error handling without key exposure",
        "regulation": "OWASP A02",
        "priority": "P0",
        "acceptanceCriteria": "GIVEN an API error WHEN returning to client THEN never include full API key in error message"
      },
      {
        "id": "SEC-008",
        "requirement": "Generate cryptographically random session IDs",
        "regulation": "OWASP A07",
        "priority": "P1",
        "acceptanceCriteria": "GIVEN a new session WHEN ID is generated THEN use CSPRNG with minimum 256 bits entropy"
      },
      {
        "id": "SEC-009",
        "requirement": "Implement request rate limiting",
        "regulation": "OWASP A04",
        "priority": "P1",
        "acceptanceCriteria": "GIVEN API endpoints WHEN request rate exceeds 100/min per session THEN return 429 Too Many Requests"
      },
      {
        "id": "SEC-010",
        "requirement": "Audit log all key operations",
        "regulation": "OWASP A09",
        "priority": "P1",
        "acceptanceCriteria": "GIVEN a connect/disconnect/validate operation WHEN completed THEN log session ID, timestamp, operation, success/failure"
      },
      {
        "id": "SEC-011",
        "requirement": "Set secure HTTP headers",
        "regulation": "OWASP A05",
        "priority": "P1",
        "acceptanceCriteria": "GIVEN any HTTP response WHEN returned THEN include CSP, X-Content-Type-Options, X-Frame-Options, HSTS headers"
      },
      {
        "id": "SEC-012",
        "requirement": "Validate provider and model parameters",
        "regulation": "OWASP A03",
        "priority": "P1",
        "acceptanceCriteria": "GIVEN provider/model parameter WHEN submitted THEN only accept enum values from allowlist"
      },
      {
        "id": "SEC-013",
        "requirement": "Session timeout and cleanup",
        "regulation": "OWASP A07",
        "priority": "P2",
        "acceptanceCriteria": "GIVEN a session WHEN inactive for 24 hours THEN automatically expire and securely delete stored keys"
      }
    ],
    "owaspChecklist": {
      "A01_BrokenAccessControl": {
        "vulnerable": false,
        "mitigated": true,
        "notes": "Session-based authorization implemented; CSRF protection needed"
      },
      "A02_CryptographicFailures": {
        "vulnerable": false,
        "mitigated": true,
        "notes": "AES-256-GCM encryption; TLS 1.3 enforced"
      },
      "A03_Injection": {
        "vulnerable": false,
        "mitigated": true,
        "notes": "Pydantic/Zod validation on all inputs"
      },
      "A04_InsecureDesign": {
        "vulnerable": true,
        "mitigated": false,
        "notes": "Rate limiting and session timeout needed"
      },
      "A05_SecurityMisconfiguration": {
        "vulnerable": true,
        "mitigated": false,
        "notes": "Security headers verification needed"
      },
      "A06_VulnerableComponents": {
        "vulnerable": true,
        "mitigated": false,
        "notes": "Dependency audit required"
      },
      "A07_AuthFailures": {
        "vulnerable": false,
        "mitigated": true,
        "notes": "Session ID validation; API key verification"
      },
      "A08_DataIntegrityFailures": {
        "vulnerable": false,
        "mitigated": true,
        "notes": "Enum validation for provider/model params needed"
      },
      "A09_LoggingFailures": {
        "vulnerable": true,
        "mitigated": false,
        "notes": "Comprehensive audit logging needed"
      },
      "A10_SSRF": {
        "vulnerable": false,
        "mitigated": true,
        "notes": "URL validation exists; low risk"
      }
    },
    "securityAnalysisDocument": "scripts/ralph/security-analysis.md"
  },
  "userStories": [
    {
      "id": "US-001",
      "title": "Create OpenAI Pydantic Schemas",
      "description": "As a developer, I want OpenAI request/response schemas so that API inputs are validated",
      "acceptanceCriteria": [
        "GIVEN an OpenAI auth request WHEN submitted THEN Pydantic validates the api_key field",
        "GIVEN an OpenAI generate request WHEN submitted THEN Pydantic validates analysis, style, and model fields",
        "npm run typecheck passes",
        "pytest backend/tests passes"
      ],
      "priority": 1,
      "complexity": 2,
      "estimatedMinutes": 20,
      "filesAffected": [
        "backend/src/models/openai_schemas.py"
      ],
      "dependencies": [],
      "testStrategy": "Unit tests for schema validation with valid and invalid inputs",
      "securityCategory": "validation",
      "state": "passed",
      "passes": true,
      "retryCount": 0,
      "notes": "",
      "completedAt": "2026-01-13T04:56:00.000Z"
    },
    {
      "id": "US-002",
      "title": "Implement OpenAI Client Service",
      "description": "As a developer, I want an OpenAI client service so that I can validate keys and generate posts",
      "acceptanceCriteria": [
        "GIVEN a valid API key WHEN calling validate_key THEN it returns True",
        "GIVEN an invalid API key WHEN calling validate_key THEN it returns False",
        "GIVEN analysis and style WHEN calling generate_linkedin_post THEN it returns generated content",
        "GIVEN a rate limit error WHEN generating THEN it raises appropriate exception with retry_after",
        "npm run typecheck passes",
        "pytest backend/tests passes"
      ],
      "priority": 1,
      "complexity": 3,
      "estimatedMinutes": 30,
      "filesAffected": [
        "backend/src/services/openai_client.py"
      ],
      "dependencies": [
        "US-001"
      ],
      "testStrategy": "Unit tests with mocked OpenAI SDK responses",
      "securityCategory": "none",
      "state": "passed",
      "passes": true,
      "retryCount": 0,
      "notes": "",
      "completedAt": "2026-01-13T13:04:21.043882Z"
    },
    {
      "id": "US-003",
      "title": "Create OpenAI Auth API Routes",
      "description": "As a user, I want API endpoints to connect, check status, and disconnect my OpenAI key",
      "acceptanceCriteria": [
        "GIVEN POST /api/auth/openai/connect with valid key WHEN called THEN returns success with masked key",
        "GIVEN POST /api/auth/openai/connect with invalid key WHEN called THEN returns authentication error",
        "GIVEN GET /api/auth/openai/status WHEN connected THEN returns connected=true with masked key",
        "GIVEN POST /api/auth/openai/disconnect WHEN called THEN removes key and returns success",
        "npm run typecheck passes",
        "pytest backend/tests passes"
      ],
      "priority": 2,
      "complexity": 3,
      "estimatedMinutes": 30,
      "filesAffected": [
        "backend/src/api/openai_routes.py",
        "backend/src/api/main.py"
      ],
      "dependencies": [
        "US-001",
        "US-002"
      ],
      "testStrategy": "Integration tests for API endpoints with mocked services",
      "securityCategory": "authentication",
      "state": "passed",
      "passes": true,
      "retryCount": 0,
      "notes": "",
      "completedAt": "2026-01-13T05:21:00.000Z"
    },
    {
      "id": "US-004",
      "title": "Extend Generation Route for OpenAI",
      "description": "As a user, I want to generate LinkedIn posts using OpenAI so that I can choose my preferred AI provider",
      "acceptanceCriteria": [
        "GIVEN POST /api/generate/ai-post with provider='openai' WHEN called THEN uses OpenAI client",
        "GIVEN provider parameter WHEN generating THEN the specified provider is used",
        "GIVEN no provider parameter WHEN generating THEN defaults to Claude for backward compatibility",
        "GIVEN model parameter for OpenAI WHEN generating THEN uses specified model",
        "npm run typecheck passes",
        "pytest backend/tests passes"
      ],
      "priority": 3,
      "complexity": 3,
      "estimatedMinutes": 25,
      "filesAffected": [
        "backend/src/api/generate_routes.py",
        "backend/src/models/claude_schemas.py"
      ],
      "dependencies": [
        "US-002",
        "US-003"
      ],
      "testStrategy": "Integration tests verifying provider routing logic",
      "securityCategory": "authorization",
      "state": "passed",
      "passes": true,
      "retryCount": 0,
      "notes": "Updated ClaudeGenerateRequest with provider and model fields. Added 8 new tests.",
      "completedAt": "2026-01-13T13:52:00.000Z"
    },
    {
      "id": "US-005",
      "title": "Add OpenAI State to Zustand Store",
      "description": "As a developer, I want OpenAI auth state in the store so that components can access connection status",
      "acceptanceCriteria": [
        "GIVEN the app store WHEN accessing openaiAuth THEN it contains isConnected, maskedKey, isLoading, error",
        "GIVEN setOpenAIConnected action WHEN called THEN updates connection state",
        "GIVEN selectedProvider state WHEN set THEN persists the selected provider",
        "npm run typecheck passes",
        "npm run test passes"
      ],
      "priority": 4,
      "complexity": 2,
      "estimatedMinutes": 20,
      "filesAffected": [
        "frontend/src/store/appStore.ts"
      ],
      "dependencies": [],
      "testStrategy": "Unit tests for store actions and state updates",
      "securityCategory": "none",
      "state": "pending",
      "passes": false,
      "retryCount": 0,
      "notes": "",
      "completedAt": null
    },
    {
      "id": "US-006",
      "title": "Add OpenAI API Functions",
      "description": "As a developer, I want API client functions for OpenAI so that frontend can communicate with backend",
      "acceptanceCriteria": [
        "GIVEN connectOpenAI function WHEN called with key THEN POSTs to /api/auth/openai/connect",
        "GIVEN getOpenAIStatus function WHEN called THEN GETs /api/auth/openai/status",
        "GIVEN disconnectOpenAI function WHEN called THEN POSTs to /api/auth/openai/disconnect",
        "GIVEN generateAIPost with provider='openai' WHEN called THEN includes provider in request",
        "npm run typecheck passes",
        "npm run test passes"
      ],
      "priority": 4,
      "complexity": 2,
      "estimatedMinutes": 20,
      "filesAffected": [
        "frontend/src/lib/api.ts"
      ],
      "dependencies": [
        "US-003"
      ],
      "testStrategy": "Unit tests with mocked fetch responses",
      "securityCategory": "none",
      "state": "pending",
      "passes": false,
      "retryCount": 0,
      "notes": "",
      "completedAt": null
    },
    {
      "id": "US-007",
      "title": "Create OpenAI Auth Form Component",
      "description": "As a user, I want a form to enter my OpenAI API key so that I can connect my account",
      "acceptanceCriteria": [
        "GIVEN the OpenAI auth form WHEN rendered THEN shows API key input field",
        "GIVEN input with invalid format WHEN submitting THEN shows validation error",
        "GIVEN valid key WHEN submitting THEN calls connectOpenAI and shows loading state",
        "GIVEN successful connection WHEN complete THEN shows success message",
        "Component renders without errors",
        "npm run typecheck passes"
      ],
      "priority": 5,
      "complexity": 3,
      "estimatedMinutes": 30,
      "filesAffected": [
        "frontend/src/components/openai-auth/OpenAIAuthForm.tsx"
      ],
      "dependencies": [
        "US-005",
        "US-006"
      ],
      "testStrategy": "Component tests for form validation and submission flow",
      "securityCategory": "validation",
      "state": "pending",
      "passes": false,
      "retryCount": 0,
      "notes": "",
      "completedAt": null
    },
    {
      "id": "US-008",
      "title": "Create OpenAI Connection Status Component",
      "description": "As a user, I want to see my OpenAI connection status so that I know if I'm connected",
      "acceptanceCriteria": [
        "GIVEN OpenAI connected WHEN viewing status THEN shows green 'Connected' badge with masked key",
        "GIVEN OpenAI not connected WHEN viewing status THEN shows the auth form",
        "GIVEN disconnect clicked WHEN confirmed THEN disconnects and shows auth form",
        "Component renders without errors",
        "npm run typecheck passes"
      ],
      "priority": 6,
      "complexity": 2,
      "estimatedMinutes": 25,
      "filesAffected": [
        "frontend/src/components/openai-auth/OpenAIConnectionStatus.tsx"
      ],
      "dependencies": [
        "US-007"
      ],
      "testStrategy": "Component tests for connection states and disconnect flow",
      "securityCategory": "none",
      "state": "pending",
      "passes": false,
      "retryCount": 0,
      "notes": "",
      "completedAt": null
    },
    {
      "id": "US-009",
      "title": "Create Provider Selector Component",
      "description": "As a user, I want to select which AI provider to use so that I can choose my preferred option",
      "acceptanceCriteria": [
        "GIVEN both providers connected WHEN viewing selector THEN shows dropdown with Claude and OpenAI",
        "GIVEN only one provider connected WHEN viewing selector THEN that provider is pre-selected",
        "GIVEN provider selected WHEN choosing THEN updates selectedProvider in store",
        "Component renders without errors",
        "npm run typecheck passes"
      ],
      "priority": 7,
      "complexity": 2,
      "estimatedMinutes": 25,
      "filesAffected": [
        "frontend/src/components/provider/ProviderSelector.tsx"
      ],
      "dependencies": [
        "US-005"
      ],
      "testStrategy": "Component tests for provider selection logic",
      "securityCategory": "none",
      "state": "pending",
      "passes": false,
      "retryCount": 0,
      "notes": "",
      "completedAt": null
    },
    {
      "id": "US-010",
      "title": "Integrate OpenAI Components into App",
      "description": "As a user, I want to see OpenAI connection option in the app so that I can connect my API key",
      "acceptanceCriteria": [
        "GIVEN the app WHEN loaded THEN shows both Claude and OpenAI connection status sections",
        "GIVEN OpenAI status component WHEN rendered in App THEN integrates with existing layout",
        "GIVEN both providers WHEN viewing THEN they appear in a logical grouped layout",
        "Component renders without errors",
        "npm run typecheck passes"
      ],
      "priority": 8,
      "complexity": 3,
      "estimatedMinutes": 30,
      "filesAffected": [
        "frontend/src/App.tsx"
      ],
      "dependencies": [
        "US-008"
      ],
      "testStrategy": "Integration tests verifying component rendering and layout",
      "securityCategory": "none",
      "state": "pending",
      "passes": false,
      "retryCount": 0,
      "notes": "",
      "completedAt": null
    },
    {
      "id": "US-011",
      "title": "Update AI Post Generator for Provider Selection",
      "description": "As a user, I want to choose which AI provider generates my post so that I can use my preferred option",
      "acceptanceCriteria": [
        "GIVEN the AI Post Generator WHEN both providers connected THEN shows provider selector",
        "GIVEN provider selected WHEN generating THEN calls API with selected provider",
        "GIVEN generation in progress WHEN loading THEN shows which provider is generating",
        "GIVEN OpenAI error WHEN generating THEN shows appropriate error message",
        "Component renders without errors",
        "npm run typecheck passes"
      ],
      "priority": 9,
      "complexity": 3,
      "estimatedMinutes": 30,
      "filesAffected": [
        "frontend/src/components/posts/AIPostGenerator.tsx"
      ],
      "dependencies": [
        "US-004",
        "US-006",
        "US-009"
      ],
      "testStrategy": "Component tests for provider selection and generation flow",
      "securityCategory": "none",
      "state": "pending",
      "passes": false,
      "retryCount": 0,
      "notes": "",
      "completedAt": null
    },
    {
      "id": "US-SEC-001",
      "title": "Implement API Key Log Filtering",
      "description": "As a security engineer, I want API keys filtered from all logs so that credentials are never exposed in log files",
      "acceptanceCriteria": [
        "GIVEN any log statement WHEN output contains 'sk-' pattern THEN replace with '[REDACTED]'",
        "GIVEN any log statement WHEN output contains 'sk-ant-' pattern THEN replace with '[REDACTED]'",
        "GIVEN structured logging WHEN api_key field exists THEN field value is redacted",
        "pytest test_log_filtering passes with 100% coverage on logging module"
      ],
      "priority": 1,
      "complexity": 2,
      "estimatedMinutes": 30,
      "filesAffected": [
        "backend/src/utils/logging.py",
        "backend/src/middleware/request_logging.py"
      ],
      "dependencies": [],
      "testStrategy": "Unit tests that verify redaction with various key patterns and positions",
      "securityCategory": "logging",
      "state": "passed",
      "passes": true,
      "retryCount": 0,
      "notes": "",
      "completedAt": "2026-01-13T13:30:00.000Z"
    },
    {
      "id": "US-SEC-002",
      "title": "Implement Request Rate Limiting",
      "description": "As a system, I want to rate limit API requests so that abuse and DoS attacks are prevented",
      "acceptanceCriteria": [
        "GIVEN a session WHEN more than 100 requests/minute to auth endpoints THEN return 429",
        "GIVEN a session WHEN more than 20 requests/minute to generation endpoints THEN return 429",
        "GIVEN rate limit exceeded WHEN returning error THEN include Retry-After header",
        "Rate limiting works correctly under concurrent request load"
      ],
      "priority": 2,
      "complexity": 3,
      "estimatedMinutes": 45,
      "filesAffected": [
        "backend/src/middleware/rate_limiter.py",
        "backend/src/api/main.py"
      ],
      "dependencies": [],
      "testStrategy": "Load tests verifying rate limiting behavior under various request patterns",
      "securityCategory": "availability",
      "state": "passed",
      "passes": true,
      "retryCount": 0,
      "notes": "",
      "completedAt": "2026-01-13T13:45:00.000Z"
    },
    {
      "id": "US-SEC-003",
      "title": "Implement Security Headers Middleware",
      "description": "As a security engineer, I want proper security headers on all responses so that common web attacks are mitigated",
      "acceptanceCriteria": [
        "GIVEN any API response WHEN returned THEN includes Content-Security-Policy header",
        "GIVEN any API response WHEN returned THEN includes X-Content-Type-Options: nosniff",
        "GIVEN any API response WHEN returned THEN includes X-Frame-Options: DENY",
        "GIVEN any API response WHEN returned THEN includes Strict-Transport-Security header",
        "Security headers pass securityheaders.com scan"
      ],
      "priority": 2,
      "complexity": 2,
      "estimatedMinutes": 25,
      "filesAffected": [
        "backend/src/middleware/security_headers.py",
        "backend/src/api/main.py"
      ],
      "dependencies": [],
      "testStrategy": "Integration tests verifying header presence on all response types",
      "securityCategory": "configuration",
      "state": "passed",
      "passes": true,
      "retryCount": 0,
      "notes": "",
      "completedAt": "2026-01-13T05:35:35.902673+00:00"
    },
    {
      "id": "US-SEC-004",
      "title": "Implement Audit Logging for Key Operations",
      "description": "As a security administrator, I want all key operations logged so that I can investigate security incidents",
      "acceptanceCriteria": [
        "GIVEN key connect operation WHEN completed THEN audit log contains session_id, timestamp, status",
        "GIVEN key disconnect operation WHEN completed THEN audit log contains session_id, timestamp",
        "GIVEN unauthorized access attempt WHEN detected THEN audit log contains full request details",
        "GIVEN audit log entry WHEN written THEN never contains actual API key",
        "Audit logs are queryable by session_id and timestamp range"
      ],
      "priority": 2,
      "complexity": 3,
      "estimatedMinutes": 40,
      "filesAffected": [
        "backend/src/services/audit_logger.py",
        "backend/src/api/openai_routes.py",
        "backend/src/api/claude_routes.py"
      ],
      "dependencies": [
        "US-SEC-001"
      ],
      "testStrategy": "Unit tests verifying audit log content and redaction",
      "securityCategory": "logging",
      "state": "passed",
      "passes": true,
      "retryCount": 0,
      "notes": "",
      "completedAt": "2026-01-13T05:43:23.512992+00:00"
    },
    {
      "id": "US-SEC-005",
      "title": "Implement Session Timeout and Cleanup",
      "description": "As a system, I want sessions to timeout automatically so that abandoned credentials are cleaned up",
      "acceptanceCriteria": [
        "GIVEN a session WHEN inactive for 24 hours THEN session is marked expired",
        "GIVEN an expired session WHEN any request is made THEN return 401 with 'session expired' message",
        "GIVEN an expired session WHEN cleaned up THEN encrypted keys are securely deleted",
        "Session cleanup runs as background task every hour"
      ],
      "priority": 3,
      "complexity": 3,
      "estimatedMinutes": 35,
      "filesAffected": [
        "backend/src/services/session_manager.py",
        "backend/src/tasks/cleanup.py"
      ],
      "dependencies": [],
      "testStrategy": "Unit tests for timeout logic, integration tests for cleanup task",
      "securityCategory": "authentication",
      "state": "pending",
      "passes": false,
      "retryCount": 0,
      "notes": "",
      "completedAt": null
    },
    {
      "id": "US-SEC-006",
      "title": "Implement Provider and Model Parameter Validation",
      "description": "As a backend developer, I want provider and model parameters strictly validated so that only allowed values are accepted",
      "acceptanceCriteria": [
        "GIVEN provider parameter WHEN not in ['claude', 'openai'] THEN return 400 Bad Request",
        "GIVEN model parameter for OpenAI WHEN not in ['gpt-4o', 'gpt-4', 'gpt-3.5-turbo'] THEN return 400",
        "GIVEN invalid parameter WHEN rejected THEN error message specifies allowed values",
        "Pydantic enum validation enforces allowed values"
      ],
      "priority": 1,
      "complexity": 1,
      "estimatedMinutes": 15,
      "filesAffected": [
        "backend/src/models/schemas.py",
        "backend/src/models/openai_schemas.py"
      ],
      "dependencies": [
        "US-001"
      ],
      "testStrategy": "Unit tests for schema validation with valid and invalid enum values",
      "securityCategory": "validation",
      "state": "passed",
      "passes": true,
      "retryCount": 0,
      "notes": "",
      "completedAt": "2026-01-13T05:15:22.310964Z"
    },
    {
      "id": "US-SEC-007",
      "title": "Secure Error Message Handling",
      "description": "As a user, I want error messages that help troubleshoot without exposing sensitive information",
      "acceptanceCriteria": [
        "GIVEN any 500 error WHEN returned THEN response contains generic message only",
        "GIVEN any error WHEN returned THEN never contains API key, path traces, or internal details",
        "GIVEN OpenAI API error WHEN returned THEN only safe error properties are passed through",
        "Error handling passes security review for information disclosure"
      ],
      "priority": 2,
      "complexity": 2,
      "estimatedMinutes": 25,
      "filesAffected": [
        "backend/src/api/error_handlers.py",
        "backend/src/services/openai_client.py"
      ],
      "dependencies": [],
      "testStrategy": "Unit tests triggering various error conditions and verifying sanitized output",
      "securityCategory": "validation",
      "state": "passed",
      "passes": true,
      "retryCount": 0,
      "notes": "",
      "completedAt": "2026-01-13T05:48:00.000Z"
    }
  ],
  "globalConstraints": [
    "All code must pass TypeScript strict mode",
    "No console.log in production code",
    "All user inputs must be validated with Zod (frontend) or Pydantic (backend)",
    "No secrets in code (use environment variables)",
    "API keys must never appear in logs",
    "Follow existing code patterns from Claude integration",
    "Maintain backward compatibility with existing Claude-only flow"
  ],
  "inScope": [
    "OpenAI API key input, validation, and secure storage",
    "OpenAI connection status display with masked key",
    "OpenAI disconnect functionality",
    "OpenAI-powered LinkedIn post generation (all 3 styles)",
    "Provider selection UI when both providers connected",
    "Model selection (gpt-4o, gpt-4, gpt-3.5-turbo)",
    "OpenAI-specific error handling (rate limits, quota, auth errors)",
    "Session-based key isolation"
  ],
  "outOfScope": [
    "Azure OpenAI support",
    "OpenAI organization ID management",
    "Fine-tuned model support",
    "OpenAI Assistant API integration",
    "Persistent API usage history",
    "OpenAI image generation (DALL-E)",
    "Cost estimation per generation",
    "Automatic provider fallback",
    "A/B testing between providers"
  ],
  "openQuestions": [
    {
      "id": "Q1",
      "question": "Should both providers be connectable simultaneously?",
      "recommendation": "Yes - provides user flexibility"
    },
    {
      "id": "Q2",
      "question": "Default model for OpenAI?",
      "recommendation": "gpt-4o - best cost/quality balance"
    },
    {
      "id": "Q3",
      "question": "Same prompts for OpenAI as Claude?",
      "recommendation": "Start same, tune if quality differs"
    },
    {
      "id": "Q4",
      "question": "Which provider is default when both connected?",
      "recommendation": "Last used provider (store in session)"
    }
  ],
  "validationScore": 91.67,
  "validationNotes": [
    "V-001: No explicit in-memory storage schema definition (Low severity)",
    "V-002: Mixed acceptance criteria format - some use GIVEN-WHEN-THEN, others use test commands (Low severity)",
    "V-003: No API rate limiting configuration for own endpoints (Low severity)"
  ]
}